controller.B.onEvent(ControllerButtonEvent.Pressed, function () {
    if (in_game) {
        if (light_on) {
            light_on = false
            multilights.toggleLighting(true)
            lantern.stopLanternEffect()
        } else {
            light_on = true
            multilights.toggleLighting(false)
            lantern.startLanternEffect(mySprite2)
        }
    }
})
function play () {
    night += 1
    game.splash("Night " + night, "Good luck..")
    tiles.setCurrentTilemap(tilemap`level1`)
    color.startFade(color.White, color.originalPalette)
    for (let value of tiles.getTilesByType(assets.tile`myTile2`)) {
        mySprite5 = sprites.create(img`
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . 7 7 . . . . 7 7 . . . . 
            . . . . 7 6 7 7 7 7 6 7 . . . . 
            . . . . . 7 f 7 7 f 7 . . . . . 
            . . . . . 7 2 7 7 2 7 . . . . . 
            . . . . . 7 2 7 7 2 7 . . . . . 
            . . . . . f 7 7 7 7 f . . . . . 
            . . . . . 7 f f f f 7 . . . . . 
            . . . . . . 6 6 6 6 . . . . . . 
            . . . . . 7 7 7 7 7 7 . . . . . 
            . . . . 7 . 7 7 7 7 7 7 . . . . 
            . . . . 7 . 7 7 7 7 . 7 . . . . 
            . . 7 7 7 . 7 . . 7 . 7 7 . . . 
            `, SpriteKind.Enemy)
        tiles.placeOnTile(mySprite5, value)
        tiles.setTileAt(value, sprites.dungeon.darkGroundCenter)
    }
    for (let value of tiles.getTilesByType(assets.tile`myTile0`)) {
        mySprite4 = sprites.create(img`
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . e 4 e 4 e e . . . . . 
            . . . . . e 2 4 4 2 e . . . . . 
            . . . . . 4 2 e 4 2 e . . . . . 
            . . . . . 4 e e 4 4 4 . . . . . 
            . . . . . e 7 5 e e e . . . . . 
            . . . . . . 7 2 e e . . . . . . 
            . . . . 7 5 e e e e e . . . . . 
            . . . . 2 5 e e e e e . . . . . 
            . . . 5 4 . e 7 e e e . . . . . 
            . . . 7 . . e e e e . . . . . . 
            . . . . . . e . . e . . . . . . 
            `, SpriteKind.Enemy)
        tiles.placeOnTile(mySprite4, value)
        tiles.setTileAt(value, sprites.dungeon.darkGroundCenter)
    }
    for (let value of tiles.getTilesByType(assets.tile`myTile1`)) {
        mySprite3 = sprites.create(img`
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . . . . . . . . . . . . 
            . . . . . a a a a a a . . . . . 
            . . . . . a f a a f a . . . . . 
            . . . . . a f a a f a . . . . . 
            . . . . . a 9 a a 9 a . . . . . 
            . . . . . 9 f f f 9 a . . . . . 
            . . . . . f a a a 9 f . . . . . 
            . . . . . . c c c c . . . . . . 
            . . . . . a a c c a a . . . . . 
            . . . . a . a a a a . a . . . . 
            . . . . a . a a a a . a . . . . 
            . . . . . . a a a a . a . . . . 
            . . . . . . a . . a . . . . . . 
            . . . . . . a . . a . . . . . . 
            `, SpriteKind.Enemy)
        tiles.placeOnTile(mySprite3, value)
        tiles.setTileAt(value, sprites.dungeon.darkGroundCenter)
    }
    for (let value of tiles.getTilesByType(assets.tile`myTile7`)) {
        statusbar = statusbars.create(60, 2, StatusBarKind.Magic)
        mySprite2 = sprites.create(img`
            . . . . f f f f . . . . . 
            . . f f f f f f f f . . . 
            . f f f f f f c f f f . . 
            f f f f f f c c f f f c . 
            f f f c f f f f f f f c . 
            c c c f f f e e f f c c . 
            f f f f f e e f f c c f . 
            f f f b f e e f b f f f . 
            . f 4 1 f 4 4 f 1 4 f . . 
            . f e 4 4 4 4 4 4 e f . . 
            . f f f e e e e f f f . . 
            f e f b 7 7 7 7 b f e f . 
            e 4 f 7 7 7 7 7 7 f 4 e . 
            e e f 6 6 6 6 6 6 f e e . 
            . . . f f f f f f . . . . 
            . . . f f . . f f . . . . 
            `, SpriteKind.Player)
        tiles.placeOnTile(mySprite2, value)
        tiles.setTileAt(value, sprites.dungeon.darkGroundCenter)
        controller.moveSprite(mySprite2)
        scene.cameraFollowSprite(mySprite2)
        multilights.toggleLighting(false)
        lantern.startLanternEffect(mySprite2)
        statusbar.attachToSprite(mySprite2)
        statusbar.setLabel("Light")
        light_on = true
        characterAnimations.loopFrames(
        mySprite2,
        [img`
            . . . . f f f f . . . . . 
            . . f f c c c c f f . . . 
            . f f c c c c c c f f . . 
            f f c c c c c c c c f f . 
            f f c c f c c c c c c f . 
            f f f f f c c c f c c f . 
            f f f f c c c f c c f f . 
            f f f f f f f f f f f f . 
            f f f f f f f f f f f f . 
            . f f f f f f f f f f . . 
            . f f f f f f f f f f . . 
            f e f f f f f f f f e f . 
            e 4 f 7 7 7 7 7 7 c 4 e . 
            e e f 6 6 6 6 6 6 f e e . 
            . . . f f f f f f . . . . 
            . . . f f . . f f . . . . 
            `,img`
            . . . . . . . . . . . . . 
            . . . . . f f f f . . . . 
            . . . f f c c c c f f . . 
            . f f f c c c c c c f f . 
            f f c c c c c c c c c f f 
            f c c c c f c c c c c c f 
            . f f f f c c c c f c c f 
            . f f f f c c f c c c f f 
            . f f f f f f f f f f f f 
            . f f f f f f f f f f f f 
            . . f f f f f f f f f f . 
            . . e f f f f f f f f f . 
            . . e f f f f f f f f e f 
            . . 4 c 7 7 7 7 7 e 4 4 e 
            . . e f f f f f f f e e . 
            . . . f f f . . . . . . . 
            `,img`
            . . . . . . . . . . . . . 
            . . . . . f f f f . . . . 
            . . . f f c c c c f f . . 
            . . f f c c c c c c f f . 
            . f f f c c c c c c c f f 
            f f f c c c c c c c c c f 
            f f c c c f c c c c c c f 
            . f f f f f c c c f c f f 
            . f f f f c c f f c f f f 
            . . f f f f f f f f f f f 
            . . f f f f f f f f f f . 
            . . f f f f f f f f f e . 
            . f e f f f f f f f f e . 
            . e 4 4 e 7 7 7 7 7 c 4 . 
            . . e e f f f f f f f e . 
            . . . . . . . . f f f . . 
            `],
        100,
        characterAnimations.rule(Predicate.MovingUp)
        )
        characterAnimations.loopFrames(
        mySprite2,
        [img`
            . . . . . . . . . . . . . 
            . . . f f f f f f . . . . 
            . f f f f f f f f f . . . 
            . f f f f f f c f f f . . 
            f f f f c f f f c f f f . 
            f c f f c c f f f c c f f 
            f c c f f f f e f f f f f 
            f f f f f f f e e f f f . 
            f f e e f b f e e f f f . 
            f f e 4 e 1 f 4 4 f f . . 
            . f f f e 4 4 4 4 f . . . 
            . 4 4 4 e e e e f f . . . 
            . e 4 4 e 7 7 7 7 f . . . 
            . f e e f 6 6 6 6 f f . . 
            . f f f f f f f f f f . . 
            . . f f . . . f f f . . . 
            `,img`
            . . . . . . . . . . . . . 
            . . . f f f f f f . . . . 
            . f f f f f f f f f . . . 
            . f f f f f f c f f f . . 
            f f f f c f f f c f f f . 
            f c f f c c f f f c c f f 
            f c c f f f f e f f f f f 
            f f f f f f f e e f f f . 
            f f e e f b f e e f f . . 
            . f e 4 e 1 f 4 4 f f . . 
            . f f f e e 4 4 4 f . . . 
            . . f e 4 4 e e f f . . . 
            . . f e 4 4 e 7 7 f . . . 
            . f f f e e f 6 6 f f . . 
            . f f f f f f f f f f . . 
            . . f f . . . f f f . . . 
            `,img`
            . . . f f f f f . . . . . 
            . f f f f f f f f f . . . 
            . f f f f f f c f f f . . 
            f f f f c f f f c f f . . 
            f c f f c c f f f c c f f 
            f c c f f f f e f f f f f 
            f f f f f f f e e f f f . 
            f f e e f b f e e f f . . 
            . f e 4 e 1 f 4 4 f . . . 
            . f f f e 4 4 4 4 f . . . 
            . . f e e e e e f f . . . 
            . . e 4 4 e 7 7 7 f . . . 
            . . e 4 4 e 7 7 7 f . . . 
            . . f e e f 6 6 6 f . . . 
            . . . f f f f f f . . . . 
            . . . . f f f . . . . . . 
            `],
        100,
        characterAnimations.rule(Predicate.MovingRight)
        )
        characterAnimations.loopFrames(
        mySprite2,
        [img`
            . . . . . f f f f f . . . 
            . . . f f f f f f f f f . 
            . . f f f c f f f f f f . 
            . . f f c f f f c f f f f 
            f f c c f f f c c f f c f 
            f f f f f e f f f f c c f 
            . f f f e e f f f f f f f 
            . . f f e e f b f e e f f 
            . . . f 4 4 f 1 e 4 e f . 
            . . . f 4 4 4 4 e f f f . 
            . . . f f e e e e e f . . 
            . . . f 7 7 7 e 4 4 e . . 
            . . . f 7 7 7 e 4 4 e . . 
            . . . f 6 6 6 f e e f . . 
            . . . . f f f f f f . . . 
            . . . . . . f f f . . . . 
            `,img`
            . . . . . . . . . . . . . 
            . . . . f f f f f f . . . 
            . . . f f f f f f f f f . 
            . . f f f c f f f f f f . 
            . f f f c f f f c f f f f 
            f f c c f f f c c f f c f 
            f f f f f e f f f f c c f 
            . f f f e e f f f f f f f 
            . . f f e e f b f e e f f 
            . . f f 4 4 f 1 e 4 e f . 
            . . . f 4 4 4 e e f f f . 
            . . . f f e e 4 4 e f . . 
            . . . f 7 7 e 4 4 e f . . 
            . . f f 6 6 f e e f f f . 
            . . f f f f f f f f f f . 
            . . . f f f . . . f f . . 
            `,img`
            . . . . . . . . . . . . . 
            . . . . f f f f f f . . . 
            . . . f f f f f f f f f . 
            . . f f f c f f f f f f . 
            . f f f c f f f c f f f f 
            f f c c f f f c c f f c f 
            f f f f f e f f f f c c f 
            . f f f e e f f f f f f f 
            . f f f e e f b f e e f f 
            . . f f 4 4 f 1 e 4 e f f 
            . . . f 4 4 4 4 e f f f . 
            . . . f f e e e e 4 4 4 . 
            . . . f 7 7 7 7 e 4 4 e . 
            . . f f 6 6 6 6 f e e f . 
            . . f f f f f f f f f f . 
            . . . f f f . . . f f . . 
            `],
        100,
        characterAnimations.rule(Predicate.MovingLeft)
        )
        characterAnimations.loopFrames(
        mySprite2,
        [img`
            . . . . f f f f . . . . . 
            . . f f f f f f f f . . . 
            . f f f f f f c f f f . . 
            f f f f f f c c f f f c . 
            f f f c f f f f f f f c . 
            c c c f f f e e f f c c . 
            f f f f f e e f f c c f . 
            f f f b f e e f b f f f . 
            . f 4 1 f 4 4 f 1 4 f . . 
            . f e 4 4 4 4 4 4 e f . . 
            . f f f e e e e f f f . . 
            f e f b 7 7 7 7 b f e f . 
            e 4 f 7 7 7 7 7 7 f 4 e . 
            e e f 6 6 6 6 6 6 f e e . 
            . . . f f f f f f . . . . 
            . . . f f . . f f . . . . 
            `,img`
            . . . . . . . . . . . . . 
            . . . . . f f f f . . . . 
            . . . f f f f f f f f . . 
            . . f f f f f f c f f f . 
            f f f f f f f c c f f f c 
            f f f f c f f f f f f f c 
            . c c c f f f e e f f c c 
            . f f f f f e e f f c c f 
            . f f f b f e e f b f f f 
            . f f 4 1 f 4 4 f 1 4 f f 
            . . f e 4 4 4 4 4 e e f e 
            . f e f b 7 7 7 e 4 4 4 e 
            . e 4 f 7 7 7 7 e 4 4 e . 
            . . . f 6 6 6 6 6 e e . . 
            . . . f f f f f f f . . . 
            . . . f f f . . . . . . . 
            `,img`
            . . . . . . . . . . . . . 
            . . . . f f f f . . . . . 
            . . f f f f f f f f . . . 
            . f f f c f f f f f f . . 
            c f f f c c f f f f f f f 
            c f f f f f f f c f f f f 
            c c f f e e f f f c c c . 
            f c c f f e e f f f f f . 
            f f f b f e e f b f f f . 
            f f 4 1 f 4 4 f 1 4 f f . 
            e f e e 4 4 4 4 4 e f . . 
            e 4 4 4 e 7 7 7 b f e f . 
            . e 4 4 e 7 7 7 7 f 4 e . 
            . . e e 6 6 6 6 6 f . . . 
            . . . f f f f f f f . . . 
            . . . . . . . f f f . . . 
            `],
        100,
        characterAnimations.rule(Predicate.MovingDown)
        )
    }
    in_game = true
    sight2 += 20
    speed += 10
}
scene.onOverlapTile(SpriteKind.Enemy, assets.tile`myTile5`, function (sprite, location) {
    music.thump.play()
    tiles.setTileAt(location, assets.tile`myTile10`)
    pause(100)
})
scene.onOverlapTile(SpriteKind.Enemy, assets.tile`myTile6`, function (sprite, location) {
    music.thump.play()
    tiles.setTileAt(location, assets.tile`myTile9`)
    pause(100)
})
sprites.onOverlap(SpriteKind.Player, SpriteKind.Enemy, function (sprite, otherSprite) {
    in_game = false
    music.smallCrash.play()
    scene.setBackgroundImage(img`
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        ................................................................................................................................................................
        `)
    tiles.setCurrentTilemap(tilemap`level2`)
    sprites.destroyAllSpritesOfKind(SpriteKind.Player)
    sprites.destroyAllSpritesOfKind(SpriteKind.Enemy)
    game.setDialogTextColor(7)
    game.setDialogFrame(img`
        f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f 
        `)
    game.setDialogCursor(img`
        f f f f f f f f f f f f f f f f 
        f f f f f f 7 7 7 7 f f f f f f 
        f f f f f f 7 7 7 7 f f f f f f 
        f f f f 7 7 f f f f 7 7 f f f f 
        f f f f 7 7 f f f f 7 7 f f f f 
        f f f f 7 7 f f f f 7 7 f f f f 
        f f f f 7 7 7 7 7 7 7 7 f f f f 
        f f 7 7 7 7 7 7 7 7 7 7 7 7 f f 
        f f 7 7 f f f f f f f f 7 7 f f 
        f f 7 7 f f f f f f f f 7 7 f f 
        f f 7 7 f f f f f f f f 7 7 f f 
        f f 7 7 f f f f f f f f 7 7 f f 
        f f 7 7 f f f f f f f f 7 7 f f 
        f f 7 7 f f f f f f f f 7 7 f f 
        f f f f f f f f f f f f f f f f 
        f f f f f f f f f f f f f f f f 
        `)
    game.showLongText(" > You lost...          " + "> But you lasted for: " + time_since_ingame_play_started + " seconds..." + "                " + "> And you got to Night " + night + "....", DialogLayout.Full)
    game.reset()
})
let time_since_ingame_play_started = 0
let speed = 0
let sight2 = 0
let statusbar: StatusBarSprite = null
let mySprite3: Sprite = null
let mySprite4: Sprite = null
let mySprite5: Sprite = null
let night = 0
let mySprite2: Sprite = null
let light_on = false
let in_game = false
let list = [img`
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . 7 7 . . . . 7 7 . . . . 
    . . . . 7 6 7 7 7 7 6 7 . . . . 
    . . . . . 7 f 7 7 f 7 . . . . . 
    . . . . . 7 2 7 7 2 7 . . . . . 
    . . . . . 7 2 7 7 2 7 . . . . . 
    . . . . . f 7 7 7 7 f . . . . . 
    . . . . . 7 f f f f 7 . . . . . 
    . . . . . . 6 6 6 6 . . . . . . 
    . . . . . 7 7 7 7 7 7 . . . . . 
    . . . . 7 . 7 7 7 7 7 7 . . . . 
    . . . . 7 . 7 7 7 7 . 7 . . . . 
    . . 7 7 7 . 7 . . 7 . 7 7 . . . 
    `, img`
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . e 4 e 4 e e . . . . . 
    . . . . . e 2 4 4 2 e . . . . . 
    . . . . . 4 2 e 4 2 e . . . . . 
    . . . . . 4 e e 4 4 4 . . . . . 
    . . . . . e 7 5 e e e . . . . . 
    . . . . . . 7 2 e e . . . . . . 
    . . . . 7 5 e e e e e . . . . . 
    . . . . 2 5 e e e e e . . . . . 
    . . . 5 4 . e 7 e e e . . . . . 
    . . . 7 . . e e e e . . . . . . 
    . . . . . . e . . e . . . . . . 
    `, img`
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . . . . . . . . . . . . 
    . . . . . a a a a a a . . . . . 
    . . . . . a f a a f a . . . . . 
    . . . . . a f a a f a . . . . . 
    . . . . . a 9 a a 9 a . . . . . 
    . . . . . 9 f f f 9 a . . . . . 
    . . . . . f a a a 9 f . . . . . 
    . . . . . . c c c c . . . . . . 
    . . . . . a a c c a a . . . . . 
    . . . . a . a a a a . a . . . . 
    . . . . a . a a a a . a . . . . 
    . . . . . . a a a a . a . . . . 
    . . . . . . a . . a . . . . . . 
    . . . . . . a . . a . . . . . . 
    `]
color.startFade(color.Black, color.originalPalette)
scene.setBackgroundImage(img`
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................22..............................................................................................................
    ................................................22...............................................2..............................................................
    ...............................................222.............................................22...............................................................
    ...............................................2..2...........................................2222222...........................................................
    ..............................................22..2.........................................22......222.........................................................
    ..............................................2...2.......................................22.2.........2222.....................................................
    ..............................................2..22......................................2..2..............2....................................................
    .............................................2...2.2........................................2...............22..................................................
    ............................................22...2.2........................................2...............2.2.................................................
    ............................................2....2..2.......................................2...............2..22...............................................
    ............................................2....2..2.......................................2...............2....22.............................................
    ...........................................2.....2...2......................................2...............2......2............................................
    ...........................................2.....2....2.....................................2...............2......2............................................
    ............................................2....2....2.....................................2...............2.......2...........................................
    ..................................2.........2....2.....2....................................2...............2.......2...........................................
    ..................................222.......2....2.....2....................................2...............2.......2...........................................
    ...................................222......2....2.....2....................................2...............2.......2...........................................
    ...................................2.2......2....2.....2....................................2...............2.......2...........................................
    ...................................2.22......2...2.....2....................................2...............2.......2...........................................
    ...................................222.22....2...2.....2.....................................2..............2.......2...........................................
    ...................................22....2...2...2.....2.....................................2..............2.......2...........................................
    ...................................2....22...2...2.....2.....................................22.............2......2............................................
    ...................................2....22...2...2....2.......................................2.............2......2............................................
    ....................................2..22.2...2..2...2........................................2.............2......2.......2....................................
    ....................................2..2..2...2..2.22..........................................2............2......2.......22...................................
    ....................................222....2..2...2............................................2............2.....2........22...................................
    ....................................22.....2222...2.............................................22..........2....2........222...................................
    .....................................2.....2.222.2...............................................2...............2........2.2...................................
    .....................................2...222..22.2................................................2.............2.........2.2...................................
    .....................................2..22..2.222....22............................................22...........2...2.....2.2...................................
    .....................................2.22...2..2..222................................................222........2...2....22.2...................................
    .....................................222....22.222............................................2.........222....2...22....2..2...................................
    .......................................2.....2................................................2...........22..2....2.....2222...................................
    .......................................2....2.2................................................2...........222....2.....22.22...................................
    .......................................2...22..222..............................................2.................2.....2...2...................................
    ........................................2..2....22..............................................22...............2.....2....2...................................
    ........................................2..2...2222...............................................22...........22......22...2...................................
    .........................................22..22.2..2222............................................2222.....2222......2.22..2...................................
    .........................................2...2..2.22...2...............................................222222.........2..2..2...................................
    .........................................2..2..2222....2.............................................................2...2.2....................................
    .........................................222...2.......22...........................................................2....2.2....................................
    ..........................................2...2........22...........................................................222..22.....................................
    ...........................................2..2.......2..2.........................................................2..2...2.....................................
    ...........................................2..2.......2...22......................................................22..2..2......................................
    ............................................222......2......2.....................................................2...22.2......................................
    ............................................22......2........22...................................................2....2.2......................................
    ............................................22......2.........222...............................................222....22.......................................
    .............................................2.....2.........2...22............................................22.22...22.......................................
    .............................................2.....2.........2.....22..........................................2...2..2.2.......................................
    .............................................2....2..........2.......22.......................................2....2..2.........................................
    ..............................................2...2..........2.........2....................................222....222..........................................
    ..............................................2..2..........22..........2.................................22..22....2...........................................
    ..............................................2..2..........2.........2..22............................222.....2....2...........................................
    ...............................................222..........2........22....22........................22..22....2...2............................................
    ................................................2..........22........2.......22....................22.....2....22..2............................................
    ................................................2..........2.........2.........2222222222222..2222222.....2.....2..2............................................
    .................................................22.......22........2.......................22......2.....2.....2.2.............................................
    ..................................................222....22.........2.............2.........22......2222..22....22..............................................
    .....................................................222.2..........2.............2..........2.........2...2....2...............................................
    ........................................................22..........2.............2..........2.........2...2...2................................................
    ..........................................................22........2.............2..........2.........2...2..22................................................
    ............................................................22......2.............2..........2.........2...222..................................................
    ..............................................................22....2.............2..........2.........22222....................................................
    ................................................................222.2.............2..........2.......22.........................................................
    ...................................................................22222..........2..........2.....22...........................................................
    ........................................................................222222....2..........2...22.............................................................
    ..............................................................................2222222........2222...............................................................
    .....................................................................................222222222..................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    ................................................................................................................................................................
    `)
let myMenu = miniMenu.createMenuFromArray([
miniMenu.createMenuItem("Play"),
miniMenu.createMenuItem("Options"),
miniMenu.createMenuItem("News"),
miniMenu.createMenuItem("Lorebook")
])
myMenu.setFrame(img`
    c c c c c c c c c c c c c c c 
    c c c c c c c c c c c c c c c 
    c c c c c c c c c c c c c c c 
    c c c c c c c c c c c c c c c 
    c c c c c c c c c c c c c c c 
    c c c c c c c c c c c c c c c 
    c c c c c c c c c c c c c c c 
    c c c c c c c c c c c c c c c 
    c c c c c c c c c c c c c c c 
    c c c c c c c c c c c c c c c 
    c c c c c c c c c c c c c c c 
    c c c c c c c c c c c c c c c 
    c c c c c c c c c c c c c c c 
    c c c c c c c c c c c c c c c 
    c c c c c c c c c c c c c c c 
    `)
myMenu.setTitle("Main Menu")
let textSprite = textsprite.create("ZERO NIGHTS AT DELTA'S")
let textSprite2 = textsprite.create("A GAME MADE BY CYBERPULSE")
textSprite.setPosition(80, 20)
textSprite2.setPosition(80, 110)
in_game = false
myMenu.onButtonPressed(controller.A, function (selection, selectedIndex) {
    music.playTone(262, music.beat(BeatFraction.Half))
    if (selection == "Play") {
        scene.setBackgroundImage(img`
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            ................................................................................................................................................................
            `)
        textSprite.destroy()
        textSprite2.destroy()
        myMenu.close()
        color.startFade(color.originalPalette, color.White)
        play()
    }
    if (selection == "Options") {
        game.showSystemMenu()
    }
    if (selection == "News") {
        game.showLongText("BETAv0.02: Welcome to ZNaD (Zero Nights At Delta's), v0.02. Small bugfixes, light will now turn off when status bar runs all the way down. LOREBOOK UPDATE! CH:2 OUT NOW!", DialogLayout.Full)
    }
    if (selection == "Lorebook") {
        game.showLongText("ZNaD Lorebook CH1 :              3:26AM, Delta's Arcade & Pizzaria got closed because of, wait.. let me look.... \"All animatronic assets have caused 1 fatality, which is 3 total, and then 3 kids were kidnapped during the Ultimate Lazer Tag game.\" I, Isaac got hired, to inspect them. But that wasn't the actual job. The actual job, was having me be left for dead with a flashlight, and 3 dangerous possesed animatronics. But how do I survive, that.. hellspawn...?", DialogLayout.Full)
        game.showLongText("ZNaD Lorebook CH2 :  It's Thursday afternoon, 2:45PM, I've gotten to Delta's, but there's no-one here. The owner emailed me the address for the place and said he would meet me here.                         Alright, I just saw a little vent or somthin' over on the wall that I THINK I can crawl through. I'll catch you guys up when I get in.", DialogLayout.Full)
        game.showLongText("Okay, so I got into the place... and I'm either hallucinating, or I might die here, no escape. The vent kinda.. uh.. collapsed.. I don't see a way outta here. Next thing you know I've found myself walkin' around in a deathtrap, and uh.. the deadly trio woke up. I immediatly hid. I couldn't for long though. I still needed to get out of here! A couple minutes later I heard a muffled \"HELLO?! ISAAC?!\" from outside and then a not so silent, \"Shoot, he's stuck in there isn't he?\" And I knew, this was gonna be my home. No way out.", DialogLayout.Full)
    }
})
game.onUpdateInterval(1000, function () {
    if (in_game) {
        time_since_ingame_play_started += 1
        if (time_since_ingame_play_started == 120) {
            sprites.destroyAllSpritesOfKind(SpriteKind.Player)
            sprites.destroyAllSpritesOfKind(SpriteKind.Enemy)
            time_since_ingame_play_started = 0
            in_game = false
            play()
        }
        if (light_on) {
            statusbar.value += -1
        } else if (statusbar.value == 0) {
            light_on = false
            lantern.stopLanternEffect()
            multilights.toggleLighting(true)
            statusbar.value += 6
        } else {
            statusbar.value += 6
        }
    }
})
forever(function () {
    if (in_game) {
        if (sight.isInSight(
        mySprite3,
        mySprite2,
        60 + sight2,
        true
        )) {
            scene.cameraShake(4, 100)
            mySprite3.follow(mySprite2, 50 + speed)
        } else {
            mySprite3.follow(null)
        }
        if (sight.isInSight(
        mySprite4,
        mySprite2,
        80 + sight2,
        true
        )) {
            scene.cameraShake(4, 100)
            mySprite4.follow(mySprite2, 80 + speed)
        } else {
            mySprite4.follow(null)
        }
        if (sight.isInSight(
        mySprite5,
        mySprite2,
        50 + sight2,
        true
        )) {
            scene.cameraShake(4, 100)
            mySprite5.follow(mySprite2, 20 + speed)
        } else {
            mySprite5.follow(null)
        }
    }
})
game.onUpdateInterval(100, function () {
    if (in_game) {
        if (characterAnimations.matchesRule(mySprite2, characterAnimations.rule(Predicate.Moving))) {
            music.footstep.play()
        }
    }
})
